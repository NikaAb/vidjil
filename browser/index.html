<!doctype html>

<!-- 
  This file is part of "Vidjil" <http://bioinfo.lifl.fr/vidjil>, V(D)J repertoire browsing and analysis
  Copyright (C) 2013, 2014 by Marc Duez <marc.duez@lifl.fr> and the Vidjil Team
  Bonsai bioinformatics at LIFL (UMR CNRS 8022, Universit√© Lille) and Inria Lille

  "Vidjil" is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  "Vidjil" is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with "Vidjil". If not, see <http://www.gnu.org/licenses/>
-->

<html>
    <head>
        <meta charset="utf-8">
        <title>Vidjil</title>

        <link rel="shortcut icon" href="./images/favicon-v.ico" type="image/x-icon">
        <link rel="icon" href="./images/favicon-v.ico" type="image/x-icon">
        <link rel="stylesheet" type="text/css" href="css/fonts/ubuntu/stylesheet.css" /> 
        <link rel="stylesheet" type="text/css" href="css/fonts/ubuntu-mono/stylesheet.css" /> 
        <link id="palette" rel="stylesheet" type="text/css" href="css/light.css" /> 
        <!--[if lte IE 8]><script src="js/r2d3.js" charset="utf-8"></script><![endif]-->
        <!--[if gte IE 9]><!-->
        <script type="text/javascript" src='js/lib/d3.v3.js'></script>
        <!--<![endif]-->
        <script type="text/javascript" src="js/lib/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/lib/jquery.form.js"></script>
        <script type="text/javascript" src='js/lib/StackBlur.js'></script>
        <script type="text/javascript" src='js/lib/jspdf.js'></script>
        <script type="text/javascript" src='js/lib/jspdf.plugin.addimage.js'></script>
        <script type="text/javascript" src='js/lib/jspdf.plugin.svgToPdf.js'></script>
        <script type="text/javascript" src='js/lib/jspdf.plugin.split_text_to_size.js'></script>
        <script type="text/javascript" src='js/lib/jspdf.plugin.standard_fonts_metrics.js'></script>
        <script type="text/javascript" src='js/lib/underscore.js'></script>
        <script type="text/javascript" src='js/lib/rgbcolor.js'></script>
        <script type="text/javascript" src='js/lib/file.js'></script>
        <script type="text/javascript" src='js/lib/jquery.zclip.js'></script>


	    <script type="text/javascript" src='js/compare.js'></script>
        <script type="text/javascript" src='js/menu.js'></script>
        <script type="text/javascript" src='js/dbscan.js'></script>
        <script type="text/javascript" src='js/germline.js'></script>
        <script type="text/javascript" src='js/germline_builder.js'></script>
        <script type="text/javascript" src='js/segmenter.js'></script>
        <script type="text/javascript" src='js/model.js'></script>
        <script type="text/javascript" src='js/clone.js'></script>
        <script type="text/javascript" src='js/list.js'></script>
        <script type="text/javascript" src="js/axis.js"> </script>
        <script type="text/javascript" src="js/graph.js"> </script>
        <script type="text/javascript" src="js/scatterPlot.js"> </script>
        <script type="text/javascript" src='js/builder.js'></script>
        <script type="text/javascript" src='js/com.js'></script>
        <script type="text/javascript" src='js/vidjil-style.js'></script>
        <script type="text/javascript" src='js/crossDomain.js'></script>
        <script type="text/javascript" src='js/pdf.js'></script>
        <script type="text/javascript" src='js/database.js'></script>
        <script type="text/javascript" src='js/conf.js'></script>
        <script type="text/javascript" src='js/stats.js'></script>
        <script type="text/javascript" src='js/shortcut.js'></script>
    </head>


    <body>

        <div id="popup-container">
            <span class="closeButton" onclick="myConsole.closePopupMsg()">X</span>
            <div id="popup-msg">
	      <noscript>
		<style type="text/css">
		  #popup-container { display:block; }
		</style>
		Your browser does not have Javascript enabled. <br />
		<a href='http://www.vidjil.org'>Vidjil</a> needs a recent browser with Javascript enabled.
	      </noscript>
	    </div>
        </div>

        <div id="file_menu" >
            <span class="closeButton" onclick="cancel();">X</span>

            <h2>Vidjil <span class='logo'>(beta)</span> &ndash; V(D)J repertoire browsing and analysis</h2>

            Data file (.vidjil):<br/>
            <input id="upload_json" type="file" name="json" /></br>
            <p class='help'>The .vidjil file stores a set of clones on several points.</p>

            Analysis file (.analysis, optional):<br/>
            <input id="upload_pref" type="file" name="pref" /></br>
            <p class='help'>The .analysis file stores all parameters set by the user (tags, colors, manual clusters).</p>

            <button onclick="document.getElementById('file_menu').style.display='none';
            m.load('upload_json','upload_pref', 200)">start</button> 
        </div>

        <div id="analysis_menu" >
            <span class="closeButton" onclick="cancel();">X</span>
            <h2>analysis menu</h2>

            Analysis file:<br/>
            <input id="upload_analysis" type="file" name="analysis" /></br></br>

            <button onclick="document.getElementById('analysis_menu').style.display='none';
                                    m.loadAnalysis('upload_analysis');">start</button> 
        </div>
        
        <!-- TOP-CONTAINER -->
        <div id="top-container">

            <div class="menu" id="db_menu" onmouseover="showSelector('dbSelector');" style="display : none">patients
                <div id="dbSelector" class="selector"><div>
                    <div class="menu_box">
                        <a class="buttonSelector" onclick="javascript:db.reload()">open patient</a>
                        <a class="buttonSelector" onclick="javascript:db.save_analysis()">save analysis</a>
                    </div>
                    <div class="menu_box">
                        <div id="last_loaded_file">
                        </div>
                    </div>
                </div></div>
            </div>

            <div class="menu" id="demo_file_menu" onmouseover="showSelector('demoSelector');">import/export
                <div id="demoSelector" class="selector"><div>
                    <div class="menu_box">
                        <a id="import_data_anchor" class="buttonSelector" onclick="javascript:loadData()">import data (.vidjil)</a>
                        <a id="import_data_analysis" class="buttonSelector" onclick="javascript:loadAnalysis()">import analysis</a>
                    </div>
                    <!--<a class="buttonSelector" onclick="javascript:m.resetAnalysis()">reset analysis</a> -->
                    <!--<a class="buttonSelector" onclick="javascript:reset()">reset all</a> -->
                    <div class="menu_box">
                        <a class="buttonSelector" onclick="javascript:m.saveAnalysis()">export analysis</a>
                        <a class="buttonSelector" onclick="javascript:pdf.make()">export pdf (graph + selected clones)</a>
                        <a class="buttonSelector" onclick="javascript:pdf.makeGraph()">export pdf (graph)</a>
                    </div>
                    <div class="menu_box">
                        <div id="upload_list">
                        </div>
                    </div>
                </div></div>
            </div>

            <div class="menu" id="cluster_menu" onmouseover="showSelector('clusterSelector');" > cluster
                <div id="clusterSelector" class="selector"><div>
                    <a class="buttonSelector" onclick="m.resetClusters();">reset all clusters</a>
                    <a class="buttonSelector" onclick="m.restoreClusters();">user</a>
                    <a class="buttonSelector" onclick="m.clusterBy(function(id){return m.clone(id).getV()});">V gene + allele</a>
                    <a class="buttonSelector" onclick="m.clusterBy(function(id){return m.clone(id).getJ()});">J gene + allele</a>
                    <!-- <a class="buttonSelector" onclick="m.clusterBy('cluster')">DBSCAN algorithm</a> -->

                    <div id="clusterby_button"> </div>
                </div></div>
            </div>

            <div class="menu" id="analysis_menu" onmouseover="showSelector('groupSelector');"> analysis
                <div id="groupSelector" class="selector">
                    <div>
                    <a class="buttonSelector" onclick="sp.changeSplitMethod('gene_v', 'gene_j');">V / J (genes)</a>
                    <a class="buttonSelector" onclick="sp.changeSplitMethod('allele_v', 'allele_j');">V / J (alleles)</a>
                    <a class="buttonSelector" onclick="sp.changeSplitMethod('gene_v', 'n');">V / N length</a>
                    <!--
                    <a class="buttonSelector" onclick="sp.changeSplitMethod('gene_v', 'nSize');">V / N length + VJ deletions</a>
                    k-->
                    <a class="buttonSelector" onclick="sp.changeSplitMethod('gene_v', 'Size')">V / abundance at selected timepoint</a>
                    <a class="buttonSelector" onclick="sp.changeSplitMethod('gene_v', 'bar')">V distribution</a>
                    <!--<a class="buttonSelector" onclick="sp.changeSplitMethod('dbscan', 'dbscan')">Graph</a>-->
                    <!--<a class="buttonSelector" onclick="sp.changeSplitMethod('graph','graph')">Edit distance distribution</a>
                    <a class="buttonSelector" onclick="sp.changeSplitMethod('dbscan','dbscan')">DBSCAN algorithm</a>-->
                    </div>
                </div>
            </div>

            <div class="menu" id="color_menu" onmouseover="showSelector('colorSelector');" > color 
                <div id="colorSelector" class="selector"><div>
                    <a class="buttonSelector" onclick="m.changeColorMethod('Tag');">by tag</a>
                    <a class="buttonSelector" onclick="m.changeColorMethod('V');">by V</a>
                    <a class="buttonSelector" onclick="m.changeColorMethod('J');">by J</a>
                    <a class="buttonSelector" onclick="m.changeColorMethod('N');">by N length</a>
                    <a class="buttonSelector" onclick="m.changeColorMethod('system');" 
                        id="color_system_button" style="display:none">by system</a>
                    <a class="buttonSelector" onclick="m.changeColorMethod('abundance');">by abundance at selected timepoint</a>
                    <!--<a class="buttonSelector" onclick="m.changeColorMethod('dbscan');">by the DBSCAN algorithm</a>-->
                </div></div>
            </div>

            <div class="menu" id="filter_menu" onmouseover="showSelector('filterSelector');" > filter
                <div id="filterSelector" class="selector"><div>
                    <div class="menu_box">
                        <span id="top_label"></span></br>
                        <input id="top_slider" type="range" min="5" max="100" step="5" value="10" onchange="m.displayTop(this.value)" />
                    </div>
                    <div class="menu_box">
                        tag visibility</br>
                        <ul id="tagList">
                        </ul>
                    </div>
                </div></div>
            </div>

            <div class="menu" id="settings_menu" onmouseover="showSelector('settingsSelector');" > settings
                <div id="settingsSelector" class="selector"><div>
                    <div class="menu_box">
                        normalization</br>
                        <form name="normalize_list" id="normalize_list">
                        </form>
                    </div>

                    <div class="menu_box">
                        normalization method</br>
                        <div class="buttonSelector" onclick="m.changeNormMethod('quantitative')" ><input type="radio" name="normalize_method" value="quantitative" checked>quantitative</input></div>
                        <div class="buttonSelector" onclick="m.changeNormMethod('rescale')" ><input type="radio" name="normalize_method" value="rescale" >rescale</input></div>
                    </div>

                    <div class="menu_box">
                        size display</br>
                        <div class="buttonSelector" onclick="m.changeNotation('scientific')"><input type="radio" name="notation" value="scientific" >scientific notation</input></div>
                        <div class="buttonSelector" onclick="m.changeNotation('percent')"><input type="radio" name="notation" value="percent" checked>percent</input></div>
                    </div>

                    <div class="menu_box">
                        point key</br>
                        <div class="buttonSelector" onclick="m.changeTimeFormat('name')"><input type="radio" name="time" value="name"  checked>name</input></div>
                        <div class="buttonSelector" onclick="m.changeTimeFormat('sampling_date')"><input type="radio" name="time" value="sampling_date" >sampling date</input></div>
                        <div class="buttonSelector" onclick="m.changeTimeFormat('delta_date')"><input type="radio" name="time" value="delta_date" >day after first sample</input></div>
                    </div>

                    <div class="submenu" id="system_menu" style="display:none">
                        <div class="menu_box">
                            germline (for color and scatterplot)</br>
                            <ul id="germline_list">
                            </ul>
                        </div>
                    </div>

                    <!--menu graph/dbscan -->
                    <div class="submenu" style="display:none">

                        <div class="menu_box">
                            <div id="DBSCANEpsSlider">
                            <input id="changeEps" type="range" min="0" max="40" step="1" value="0" onchange="m.changeEps(this.value)" />
                            </div>
                        </div>

                        
                        <div class="menu_box">
                            <div id="DBSCANNbrSlider">
                            <input id="changeNbr" type="range" min="0" max="100" step="1" value="0" onchange="m.changeNbr(this.value)" />
                            </div>
                        </div>

                    
                        <div class="menu_box">
                            <div id="EditDistanceSlider">
                            </br>
                            <input id="displayMax_slider" type="range" min="1" max="20" step="1" value="10" onchange="sp.displayDistanceMax(this.value)" style="display:none"/>
                            </div>
                        </div>
                    </div>

                </div></div>
            </div>

            <div id="debug_menu" class="menu" onmouseover="showSelector('adminSelector');" style="display : none"> development
                <div id="adminSelector" class="selector"><div>
                    <input type="checkbox" onclick="m.display_window = this.checked; m.update()">highlight windows</input><br>
                    <input type="checkbox" onclick=" this.checked ? $('#fps').css('display', '') : $('#fps').css('display', 'none');">display fps</input></br>
                    <input type="checkbox" onclick=" this.checked ? myConsole.openLog() : myConsole.closeLog() ;">log</input>
                    <a class="buttonSelector" onclick="db.call('default/user/register')">register new user</a>
                </div></div>
            </div>

            <div id="logo" style="float: right;" onclick="myConsole.popupMsg(myConsole.msg.welcome)">Vidjil <span class='logo'>(beta)</span></div>

            <div class="menu" style="float: right"> <a href="help" target="_blank">help</a></div>

            <div style="float: right" class="menu" onmouseover="showSelector('paletteSelector');"> palette 
                <div id="paletteSelector" class="selector"><div>
                    <a class="buttonSelector" onclick="changeStyle(solarizeD)">dark</a>
                    <a class="buttonSelector" onclick="changeStyle(solarizeL)">light</a>
                </div></div>
            </div>

            <div id="fps" style="float: right; display: none"> </div>

        </div>  
        <!-- fin top-container-->
        
        <!-- MID-CONTAINER -->
        <div id="mid-container" onmouseover="hideSelector()">

        <!-- LEFT-CONTAINER -->
            <div id="left-container">
                <div id="info-row"><div id="info"> </div></div>
                <div id="list-row"><div id="list"> </div></div>
                <div id="data-row"><div id="data"> </div></div>
            </div>
        <!-- fin left-container -->

            <div id="vertical-separator"></div>

        <!-- RIGHT-CONTAINER -->
            <div id="right-container"></div>

        <!-- VISU-CONTAINER  -->
            <div id="visu-container">
                <div id="visu2"></div>
                <div id="visu-separator" >...</div>
                <div id="visu" onclick=""></div>
            </div>

        </div>
        <!-- fin mid-container -->
    

        <!-- BOT-CONTAINER / SEGMENTER-CONTAINER -->
        <div id="bot-container"> </div>

        <div id="tagSelector">
            <span class="closeButton" onclick="$('#tagSelector').hide('fast')">X</span>
            <div>   tag for <span id=tag_name></span><span id=tag_id></span></div>
            <ul> </ul>
        </div>

        <div id="dataMenu">
            <span class="closeButton" onclick="$('#dataMenu').hide('fast')">X</span>
            <div> data :  <span id=data_name></span></div>
            <div>
                <span>expected size : </span>
                <span><input type="number" step="0.0001" id="normalized_data"></span>
                <button id="normalized_data_button">ok</button>
            </div>
        </div>

        <div id="frame-container"></div>

        <div id="data-container">
            <span class="closeButton" onclick="myConsole.closeDataBox()">X</span>
            <div id="data-msg"></div>
        </div>

        <div id="db_div">
            <span class="closeButton" onclick="db.close()">X</span>
            <div id="db_msg"></div>
        </div>
        
        <div id="flash_container"></div>
        <div id="log_container"></div>

        <form id="form"></form>

    </body>

    <script type="text/javascript" src='test/dataTest.js'></script>
    <script type="text/javascript" src="js/main.js"> </script>
</html>

  
