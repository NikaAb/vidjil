{{extend 'db_layout.html'}}

<h3>{{=query[0].sequence_file.filename}} Results</h3>

<!-- <div class="db_block">
    <div class="db_block_left">
        search
        <input id="db_filter_input" type="text" value="{{=request.vars["filter"]}}"  onchange="db.call('results_file/list', {'filter' : this.value} )">
    </div>
</div> -->

<div id="db_table_container">
    <table class="db_table" id="table">


        <thead>
            <tr>
                <td class="column1" >file_name</td>
                <td class="column2" >config</td>
                <td> </td>
                <td class="column1">patient</td>
                <td class="column2">producer</td>
                <td class="column2">last process</td>
                <td class="column2">status</td>
                <td class="column5"></td>
                <td class="column4"></td>
            </tr>
        </thead>


       {{for row in query :}}
           <tr>
               <td> {{=row.sequence_file.filename}} </td>
               <td> {{=row.config.name}} </td>
               <td></td>
               <td> {{=row.patient.last_name + " " + row.patient.first_name }} </td>
               <td> {{=row.sequence_file.producer}} </td>
               {{if row.results_file.run_date :}}
                   <td class="button" onclick="db.call('results_file/info', { 'results_file_id' : '{{=row.results_file.id}}' } )"> {{=row.results_file.run_date }}</td>
               {{else:}}<td></td>{{pass}} 
               <td> {{=row.status}} </td>
               <td class="pointer" onclick="db.call('results_file/confirm', {'results_file_id' :'{{=row.results_file.id}}'})" > X </td>
               <td>
               {{if row.results_file.id == None or ( row.status != "RUNNING" and row.status != "QUEUED" and row.status != "ASSIGNED"):}}
                   {{if auth.can_process_file() :}}
                       <span class="button" onclick="db.call('default/run_request', { 'sequence_file_id' : '{{=row.sequence_file.id}}', 'config_id' : {{=row.config.id}} } )"> run >> </span>
                   {{else:}}<span class="button inactive" title="you don't have permission to schedule runs"> run >> </span>{{pass}}
               {{pass}}
               </td>
            </tr>
        {{pass}}



    </table>
    <table class="db_table" id="db_fixed_header"></table>
</div>