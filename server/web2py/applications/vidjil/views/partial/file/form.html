<fieldset name="file{{=i}}">
    <legend>Sample {{=i+1}}</legend>
    <input type="hidden" id="filename_{{=i}}" name="file[{{=i}}][filename]" type="text" value="">
    <input type="hidden" id="file_id_{{=i}}" name="file[{{=i}}][id]"
        value="{{if 'id' in file:}}{{=file['id']}}{{pass}}" >
    <input type="hidden" id="sample_set_id" name="sample_set_id" value="{{if "sample_set_id" in request.vars:}}{{=request.vars["sample_set_id"]}}{{pass}}" >
    <input type="hidden" id="sample_type" name="sample_type" value="{{=sample_type}}" />

    {{ if source_module_active: }}
    <fieldset name="file_source">
        <legend>file source</legend>
        <label for="file_source_computer_{{=i}}">my computer</label>
        <input type="radio" id="file_source_computer_{{=i}}" name="file[{{=i}}][source]" value="computer" onchange="db.toggle_file_source()" checked="checked"/>
        <label for="file_source_nfs_{{=i}}">network</label>
        <input type="radio" id="file_source_nfs_{{=i}}" name="file[{{=i}}][source]" value="nfs" onchange="db.toggle_file_source()"/>
    </fieldset>
    {{pass}}
    <fieldset name="sequence_file">
        <legend>sequence file(s)</legend>
        <div {{if source_module_active:}} hidden {{pass}}>
            <label for="pre_process_{{=i}}" id="pre_process__label_{{=i}}">pre-process scenario: </label>
            <select id="pre_process_{{=i}}" name="file[{{=i}}][pre_process]" onChange="db.pre_process_onChange()" {{if source_module_active:}} disabled {{pass}}>
                <option required_files="1" value="0">no pre-process (1 file)</option>
                {{for row in pre_process_list :}}
                    <option title="{{=row["info"]}}" required_files="{{=row["file"]}}" value="{{=row["id"]}}"
                        {{if 'file_id' in request.vars and row["id"]==file.pre_process_id :}}selected{{pass}}>
                        {{=row["id"]}} &ndash; {{=row["name"]}}
                    </option>
                {{pass}}
            </select>
        </div>
        <div id="file_field_1_{{=i}}" class="field_div" {{if source_module_active:}} hidden {{pass}}>
            <label for="file_1_{{=i}}" id="file__label_{{=i}}"> file 1 </label>
            <input class="upload_field form-control" id="upload_file_1_{{=i}}" type="file"
            {{if source_module_active:}}
                disabled
            {{pass}}
                onchange="document.getElementById('file_filename_{{=i}}').value=this.value"
            ><span>* (.fa, .fastq, .fa.gz, .fastq.gz, .clntab)</span>
    </div>
    <div id="file_2_{{=i}}" class="field_div">
            <label for="file_2_{{=i}}" id="file2__label_{{=i}}"> file 2 </label>
            <input class="upload_field form-conrol" id="upload_file_2_{{=i}}" type="file"  {{if source_module_active:}} disabled {{pass}}><span>* (.fa, .fastq, .fa.gz, .fastq.gz, .clntab)</span>
        </div>
        <div  {{if not source_module_active:}} hidden {{pass}}>
            selected
            <div id="file_indicator_{{=i}}"></div>
        </div>
        <div {{if not source_module_active:}} hidden {{else:}}  onmouseover="db.set_jstree($('#jstree_{{=i}}'))" {{pass}}>
            file
            <div id="jstree_{{=i}}"></div>
        </div>
    </fieldset>

    <fieldset>
        <legend>set selection</legend>
        <div>
            You must associate this sample with at least one patient, run or set.<br>You can also associate it with any combination of the three.
        </div>
        <div class="field_div">
            <label for="set_ids_{{=i}}" id="set_ids__label_{{=i}}">sets: </label>
            <div class="token_div form-control" onclick="$('#token_input_{{=i}}').focus()">
                <input
                    hidden
                    id="file_set_list_{{=i}}"
                    name="file[{{=i}}][set_ids]"
                    type="text"
                    value="{{=",".join([set['id'] for set in file['sets']])}}">
                <div id="set_div_{{=i}}" class="token_container">
                    {{ for set in file['sets']: }}
                        <span class="set_token {{=set['type']}}_token" data-set-id="{{=set['id']}}">
                            <i class="icon-cancel" onclick="this.parentNode.parentNode.removeChild(this.parentNode);"></i>
                            {{=set['id'][3:]}}
                        </span>
                    {{pass}}
                </div>
                <input
                    id="token_input_{{=i}}"
                    class="token_input"
                    autocomplete="off"
                    onfocus="new VidjilAutoComplete().setupSamples(this);
                    new Tokeniser().setup(this, document.getElementById('set_div_{{=i}}'), document.getElementById('file_set_list_{{=i}}'));"
                    data-needs-atwho="true"
                    data-needs-tokeniser="true"
                    data-group-ids="{{=group_ids}}"
                    data-keys='["generic", "patient", "run"]'
                    type="text">
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>sample information</legend>
        <div class="field_div">
            <label for="sampling_date_{{=i}}" id="sampling_date__label_{{=i}}">sampling date: </label>
            <input class="date form-control" id="sampling_date_{{=i}}" name="file[{{=i}}][sampling_date]" type="text"
                value="{{if 'sampling_date' in file and file['sampling_date'] is not None:}}{{=file['sampling_date']}}{{pass}}"
                placeholder="yyyy-mm-dd" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}">
        </div>
        <div class="field_div">
            <label for="file_info_{{=i}}" id="file_info__label_{{=i}}">info: </label>
            <textarea id="file_info_{{=i}}"
                onfocus="new VidjilAutoComplete().setupTags(this);"
                data-needs-atwho="true"
                data-keys="{{=group_ids}}"
                class="text form-control"
                name="file[{{=i}}][info]"
                rows="1">{{if 'info' in file and file['info'] is not None:}}{{=file['info']}}{{pass}}</textarea>
        </div>
    </fieldset>
</fieldset>
