<div>
    <div>Sample {{=i+1}}</div>
    {{ if file is not None and 'error' in file and len(file['error']) > 0: }}
        <div class="error">error: {{=", ".join(file['error'])}}</div>
    {{ pass }}
    {{ if file is not None and 'message' in file and len(file['message']) > 0: }}
        <div>{{=", ".join(file['message'])}}</div>
    {{ pass }}
    <div>
        <input type="hidden" id="file_filename_{{=i}}" class="filename" name="file[{{=i}}][filename]" type="text" value="">
        <input type="hidden" id="file_id_{{=i}}" name="file[{{=i}}][id]"
            value="{{if 'id' in file:}}{{=file['id']}}{{pass}}" >
        <input type="hidden" id="sample_set_id" name="sample_set_id" value="{{if "sample_set_id" in request.vars:}}{{=request.vars["sample_set_id"]}}{{pass}}" >
        <input type="hidden" id="sample_type" name="sample_type" value="{{=sample_type}}" />
    </div>

    <div class="field_div">
        <div id="file_field_1_{{=i}}" class="field_div file_1" {{if source_module_active:}} hidden {{pass}}>
            <input class="upload_field form-control" id="file_upload_1_{{=i}}" type="file"
            {{if source_module_active:}}
                disabled
            {{pass}}
                onchange="db.upload_file_onChange('file_filename_{{=i}}', this.value)"
                title="(.fa, .fastq, .fa.gz, .fastq.gz, .clntab)"
            >
        </div>
        <div id="file_2_{{=i}}" class="field_div file_2" hidden>
            <input class="upload_field form-control" id="file_upload_2_{{=i}}" type="file"
            {{if source_module_active:}}
                disabled
            {{pass}}
                title="(.fa, .fastq, .fa.gz, .fastq.gz, .clntab)"
            >
        </div>
        <div class="jstree_container" {{if not source_module_active:}} hidden {{pass}}>
            selected
            <div id="file_indicator_{{=i}}"></div>
            <div class="jstree" id="jstree_loader_{{=i}}"
                {{if not source_module_active:}}
                    hidden
                {{else:}}
                    onload="db.set_jstree($('#jstree_{{=i}}'), {{=i}})"
                {{pass}}>
                file
                <div id="jstree_{{=i}}" data-index="{{=i}}"></div>
            </div>
        </div>
    </div>
    <div class="field_div">
        <input class="date form-control" id="sampling_date_{{=i}}" name="file[{{=i}}][sampling_date]" type="text"
            value="{{if 'sampling_date' in file and file['sampling_date'] is not None:}}{{=file['sampling_date']}}{{pass}}"
            placeholder="Sampling Date (yyyy-mm-dd)" pattern="(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))">
    </div>
    <div class="field_div">
        <textarea id="file_info_{{=i}}"
            onfocus="new VidjilAutoComplete().setupTags(this);"
            data-needs-atwho="true"
            data-keys="{{=group_ids}}"
            class="text form-control"
            name="file[{{=i}}][info]"
            rows="1"
            placeholder="Info">{{if 'info' in file and file['info'] is not None:}}{{=file['info']}}{{pass}}</textarea>
    </div>
    <div class="field_div">
        <div class="token_div form-control" onclick="$('#token_input_{{=i}}').focus()">
            <input
                hidden
                id="file_set_list_{{=i}}"
                name="file[{{=i}}][set_ids]"
                type="text"
                value="{{=",".join([set['id'] for set in file['sets']])}}">
            <div id="file_set_div_{{=i}}" class="token_container">
                {{ for set in file['sets']: }}
                    <span class="set_token {{=set['type']}}_token" data-set-id="{{=set['id']}}">
                        <i class="icon-cancel" onclick="new Tokeniser(document.getElementById('file_set_div_{{=i}}'), document.getElementById('file_set_list_{{=i}}')).removeToken(this.parentNode);"></i>
                        {{=set['id'][3:]}}
                    </span>
                {{pass}}
            </div>
            <input
                id="token_input_{{=i}}"
                class="token_input"
                autocomplete="off"
                onfocus="new VidjilAutoComplete().setupSamples(this);
                new Tokeniser(document.getElementById('file_set_div_{{=i}}'), document.getElementById('file_set_list_{{=i}}'));"
                data-needs-atwho="true"
                data-needs-tokeniser="true"
                data-group-ids="{{=upload_group_ids}}"
                data-keys='["generic", "patient", "run"]'
                placeholder="Sets"
                type="text">
        </div>
    </div>
</div>
